rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Enforces user-specific access to user profiles.
     * @path /users/{userId}
     * @allow (create) - Authenticated user can create their own profile.
     * @allow (get, list, update, delete) - Authenticated user can only access their own profile.
     * @deny (create) - Cannot create a profile with a different user ID.
     * @deny (get, list, update, delete) - Cannot access another user's profile.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userId} {
      // Helper function to check if the requesting user is the owner of the document.
      function isOwner(userId) {
        return request.auth != null && request.auth.uid == userId;
      }

      // Helper function to check if the requesting user is the existing owner of the document.
      function isExistingOwner(userId) {
        return isOwner(userId) && resource.data.uid == userId;
      }

      // Read Permissions
      allow get: if isOwner(userId);
      allow list: if isOwner(userId); // Allow listing of your own profile.

      // Write Permissions
      allow create: if request.auth != null && request.auth.uid == userId;
      allow update: if isExistingOwner(userId);
      allow delete: if isExistingOwner(userId);
    }

    /**
     * @description Enforces user-specific access to projects.
     * @path /projects/{projectId}
     * @allow (create) - Authenticated user can create a new project with themselves as the owner.
     * @allow (get, list, update, delete) - Authenticated user can only access their own projects.
     * @deny (create) - Cannot create a project with a different owner ID.
     * @deny (get, list, update, delete) - Cannot access another user's project.
     * @principle Enforces document ownership for all operations.
     */
    match /projects/{projectId} {
      // Helper function to check if the requesting user is the owner of the document.
      function isOwner(ownerId) {
        return request.auth != null && request.auth.uid == ownerId;
      }

      // Helper function to check if the requesting user is the existing owner of the document.
      function isExistingOwner(ownerId) {
        return isOwner(ownerId) && resource.data.ownerId == ownerId;
      }

      // Read Permissions
      allow get: if isOwner(resource.data.ownerId);
      allow list: if request.auth.uid != null && request.auth.uid == resource.data.ownerId;

      // Write Permissions
      allow create: if request.auth != null && request.auth.uid == request.resource.data.ownerId;
      allow update: if isExistingOwner(resource.data.ownerId);
      allow delete: if isExistingOwner(resource.data.ownerId);
    }

    /**
     * @description Enforces user-specific access to tasks.
     * @path /tasks/{taskId}
     * @allow (create) - Authenticated user can create a new task with themselves as the owner or assignee.
     * @allow (get, list, update, delete) - Authenticated user can only access their own tasks.
     * @deny (create) - Cannot create a task with a different owner or assignee ID.
     * @deny (get, list, update, delete) - Cannot access another user's task.
     * @principle Enforces document ownership for all operations.
     */
    match /tasks/{taskId} {
      // Helper function to check if the requesting user is the owner of the document.
      function isOwner(ownerId) {
        return request.auth != null && request.auth.uid == ownerId;
      }

      // Helper function to check if the requesting user is the existing owner of the document.
      function isExistingOwner(ownerId) {
        return isOwner(ownerId) && resource.data.ownerId == ownerId;
      }

        // Helper function to check if the requesting user is the assignee of the document.
        function isAssignee(assigneeId) {
            return request.auth != null && request.auth.uid == assigneeId;
        }

        // Helper function to check if the requesting user is the existing assignee of the document.
        function isExistingAssignee(assigneeId) {
            return isAssignee(assigneeId) && resource.data.assigneeId == assigneeId;
        }

      // Read Permissions
      allow get: if isOwner(resource.data.ownerId) || isAssignee(resource.data.assigneeId);
      allow list: if request.auth.uid != null && request.auth.uid == resource.data.ownerId;

      // Write Permissions
      allow create: if request.auth != null;
      allow update: if isExistingOwner(resource.data.ownerId) || isExistingAssignee(resource.data.assigneeId);
      allow delete: if isExistingOwner(resource.data.ownerId);
    }

     /**
      * @description Enforces user-specific access to invoices.
      * @path /invoices/{invoiceId}
      * @allow (create) - Authenticated user can create a new invoice with themselves as the owner.
      * @allow (get, list, update, delete) - Authenticated user can only access their own invoices.
      * @deny (create) - Cannot create an invoice with a different owner ID.
      * @deny (get, list, update, delete) - Cannot access another user's invoice.
      * @principle Enforces document ownership for all operations.
      */
    match /invoices/{invoiceId} {
      // Helper function to check if the requesting user is the owner of the document.
      function isOwner(ownerId) {
        return request.auth != null && request.auth.uid == ownerId;
      }

      // Helper function to check if the requesting user is the existing owner of the document.
      function isExistingOwner(ownerId) {
        return isOwner(ownerId) && resource.data.ownerId == ownerId;
      }

      // Read Permissions
      allow get: if isOwner(resource.data.ownerId);
      allow list: if request.auth.uid != null && request.auth.uid == resource.data.ownerId;

      // Write Permissions
      allow create: if request.auth != null && request.auth.uid == request.resource.data.ownerId;
      allow update: if isExistingOwner(resource.data.ownerId);
      allow delete: if isExistingOwner(resource.data.ownerId);
    }

    /**
     * @description Enforces user-specific access to expenses.
     * @path /expenses/{expenseId}
     * @allow (create) - Authenticated user can create a new expense with themselves as the owner.
     * @allow (get, list, update, delete) - Authenticated user can only access their own expenses.
     * @deny (create) - Cannot create an expense with a different owner ID.
     * @deny (get, list, update, delete) - Cannot access another user's expense.
     * @principle Enforces document ownership for all operations.
     */
    match /expenses/{expenseId} {
      // Helper function to check if the requesting user is the owner of the document.
      function isOwner(ownerId) {
        return request.auth != null && request.auth.uid == ownerId;
      }

      // Helper function to check if the requesting user is the existing owner of the document.
      function isExistingOwner(ownerId) {
        return isOwner(ownerId) && resource.data.ownerId == ownerId;
      }

      // Read Permissions
      allow get: if isOwner(resource.data.ownerId);
      allow list: if request.auth.uid != null && request.auth.uid == resource.data.ownerId;

      // Write Permissions
     allow create: if request.auth != null && request.auth.uid == request.resource.data.ownerId;
      allow update: if isExistingOwner(resource.data.ownerId);
      allow delete: if isExistingOwner(resource.data.ownerId);
    }

    /**
     * @description Enforces user-specific access to contacts.
     * @path /contacts/{contactId}
     * @allow (create) - Authenticated user can create a new contact with themselves as the owner.
     * @allow (get, list, update, delete) - Authenticated user can only access their own contacts.
     * @deny (create) - Cannot create a contact with a different owner ID.
     * @deny (get, list, update, delete) - Cannot access another user's contact.
     * @principle Enforces document ownership for all operations.
     */
    match /contacts/{contactId} {
      // Helper function to check if the requesting user is the owner of the document.
      function isOwner(ownerId) {
        return request.auth != null && request.auth.uid == ownerId;
      }

      // Helper function to check if the requesting user is the existing owner of the document.
      function isExistingOwner(ownerId) {
        return isOwner(ownerId) && resource.data.ownerId == ownerId;
      }

      // Read Permissions
      allow get: if isOwner(resource.data.ownerId);
      allow list: if request.auth.uid != null && request.auth.uid == resource.data.ownerId;

      // Write Permissions
      allow create: if request.auth != null && request.auth.uid == request.resource.data.ownerId;
      allow update: if isExistingOwner(resource.data.ownerId);
      allow delete: if isExistingOwner(resource.data.ownerId);
    }
  }
}